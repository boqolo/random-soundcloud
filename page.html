<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title> Random </title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"> </script>
  <script src="/node_modules/howler/dist/howler.js"> </script>
  <script type="text/javascript"> // put this in separate file eventually
    let i = 0;
    let curr = "/";
    let carousel = ["/", "/", "/", "/", "/", "/", "/", "/", "/", "/"];
    var cors_api_url = "https://cors-anywhere.herokuapp.com/";
    var xhr = new XMLHttpRequest(); // builtin browser object to make requests

    function logger(msg) {
      console.log(msg);
    }

    function getId() {
      return Math.floor(Math.random() * 999999999) + 10;
    }

    function getClientID() {
      // TODO
    }

    function nextTrackURL(track_id) {
      let temp = "https://api-v2.soundcloud.com/tracks/";
      temp = temp.concat(track_id.toString());
      temp = temp.concat('?client_id=yBT1d8kK7at5QuM6ik9RFcvPvDTi4xyP');
      //temp = temp.concat('&user_id=159851876');
      //let temp = 'https://api-v2.soundcloud.com/search?q=36plain&client_id=yBT1d8kK7at5QuM6ik9RFcvPvDTi4xyP&limit=20&app_locale=en';
      return temp;
    }

    // Returns next random track api url
    function next() {
      let n = nextTrackURL(getId());
      //document.getElementById("track").href = n;
      carousel[i % 10] = n;
      i = i + 1;
      curr = n;
      logger(i);
      logger(carousel);
      return n;
    }

    // Returns previous track api url from cache
    function back() {
      i = i - 1;
      if (i === 0) i = 1;
      curr = carousel[(i - 1) % 10];
      //document.getElementById("track").href = curr;
      logger(i);
      logger(carousel);
      return curr;
    }

    // Reload (mutate) XMLHTTP obj with next track
    function prepareAPIRequest() {
      const api_url = next();
      const options = {
        method: "GET",
        url: api_url,
      }
      xhr.open(options.method, cors_api_url + options.url); // specify the request
    }

    function playSound() {
      // TODO
    }

    /** jQuery starts here **/

    // on page load
    $(document).ready(() => { 
      alert("Hi, this is jQuery");

      $("#play").click(() => {
        logger("clicked play button");
        // TODO
      });

      $("#next").click(() => {
        logger("clicked next button");
        // TODO
        prepareAPIRequest();
        xhr.onload = function () { // the callback triggered on circumstance
          logger(
            xhr.status + ' ' + xhr.statusText + '\n\n' +
            (xhr.responseText || '')
          );
        };
        xhr.onerror = // TODO
        xhr.send();
      });

      $("#back").click(() => {
        logger("clicked back button");
        // TODO
      });

    });
  </script>
</head>

<body>

<a href="/" id="track"> Im a link </a> 

<button id="next"> next </button>
<button id="back"> back </button>
<button id="play"> play </button>

</body>

</html>
